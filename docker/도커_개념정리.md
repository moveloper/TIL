# ë„ì»¤

## âœ” VirtualBoxë¡œ ë„¤íŠ¸ì›Œí¬ ê°œë… ê³µë¶€í•˜ê¸°(1)

ip a: ë¦¬ëˆ…ìŠ¤ IP ì£¼ì†Œ í™•ì¸  
mobaxterm: ìœˆë„ìš°ìš© í„°ë¯¸ë„

apt-get install apache2  
ìš°ë¶„íˆ¬ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €   
íŒ¨í‚¤ì§€ ì´ë¦„ì€ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.   

`yum (-y) install (-y) httpd (-y) -y`: ë¬´ì¸ì„¤ì¹˜ì‹œ ìë™ìœ¼ë¡œ yë¥¼ ì…ë ¥í•´ì£¼ëŠ” ì˜µì…˜ --> 
ì•„íŒŒì¹˜ ì›¹ì„œë²„ ì„¤ì¹˜
		
1. í¬íŠ¸í¬ì›Œë“œ
2. ì›¹ì„œë²„ êµ¬ë™: 
systemctl start httpd
3. ë°©í™”ë²½ ì„¤ì •:
systemctl status firewalld	  

`systemctl enable httpd`: ì‹œì‘ì‹œ ìë™ìœ¼ë¡œ êµ¬ë™í•˜ë„ë¡ ë“±ë¡(startëŠ” ì•ˆì‹œì¼œì¤Œ)  
`systemctl disable firewalld`: ì‹œì‘ì‹œ ìë™ìœ¼ë¡œ êµ¬ë™ì‹œí‚¤ì§€ ì•Šë„ë¡ ë“±ë¡(stopì€ ì•ˆì‹œì¼œì¤Œ)  
`systemctl start httpd`: ì„œë¹„ìŠ¤ ì‹œì‘   
`systemctl stop httpd`: ì„œë¹„ìŠ¤ ì¤‘ì§€   
`systemctl status firewalld`: ì„œë¹„ìŠ¤ ìƒíƒœ ë³´ê¸°   

`systemctl enable --now httpd`: ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  ìë™ ì‹œì‘ ë“±ë¡  
`systemctl disable --now httpd`: ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•˜ê³  ìë™ ì‹œì‘ í•´ì œ  

.vdi(Virtual Disk Image) --> ë‚´ë³´ë‚´ê¸° --> ova(Open Virtualization Format Archive): ì••ì¶•(ì´ë¯¸ì§€ë¼ê³  ìƒê°)

ğŸš«ë§¥ë¶â€”>VM ë„¤íŠ¸ì›Œí¬ë¡œ SSH ì—°ê²° ì•ˆë˜ëŠ” ì´ìœ : ë§¥ì€ ë²„ì¶”ì–¼ë°•ìŠ¤ë¥¼ ì„¤ì¹˜í•  ë•Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì¹˜í•´ ì£¼ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë”°ë¡œ ì„¤ì¹˜ë¥¼ í•´ì£¼ê³  í• ë‹¹ëœ IPì£¼ì†Œë¡œ ì ‘ì†í•´ì•¼ í•œë‹¤. https://naleejang.tistory.com/167

## âœ” Nat vs Nat network vs Bridge vs Host-Only
0) ì •ë¦¬ëœ ê¸€: https://dksshddl.tistory.com/entry/Ubuntu-VirtualBox-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC
â€”> ë²„ì¶”ì–¼ ë°•ìŠ¤ì—ì„œ NAT ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ì‹œ 10.0.2.15ë¡œ ì•„ì´í”¼ê°€ ê³ ì •ëœë‹¤. ê°€ìƒë¨¸ì‹ ì´ 3ê°œê°€ NATìœ¼ë¡œ ì„¤ì •ë˜ì—ˆë‹¤ë©´ 3ê°œ ëª¨ë‘ 10.0.2.15ë¡œ ê°™ì€ ì•„ì´í”¼ì™€ ê°ê¸° ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ê°€ì§€ê³  ìˆë‹¤. 
ì˜ë¬¸ì 1: ìœˆë„ìš° í˜¸ìŠ¤íŠ¸ IPì˜ 80í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ â€”> VirtualBoxì—ì„œ ê°€ìƒë¨¸ì‹ ìœ¼ë¡œ í¬íŠ¸í¬ì›Œë”© â€”> ì ‘ì†ì˜ë¨. ì´ì™€ ê°™ì€ ê²°ê³¼ì˜€ëŠ”ë°, 3ê°œì˜ ê°€ìƒë¨¸ì‹ ì„ ë™ì‹œì— ëŒë¦¬ë©´ì„œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì–´ë–¤ ê²°ê³¼ë¥¼ ë‚˜íƒ€ë‚¼ê¹Œ  
	â€”> 2ê°œ ë™ì‹œì— ëŒë ¤ë„ ë¨. ë‘˜ ë‹¤ ì•ˆë˜ì–´ì•¼í•œë‹¤ê³  ìƒê°í–ˆì§€ë§Œ ì›¹ì„œë²„ê°€  ëŒì•„ê°”ëŠ”ë°, ì´ëŠ” ìš°ì„ ìˆœìœ„ì— ì„¤ì •ì— ë”°ë¥¸ ê²°ê³¼ë¼ê³  í•¨. ì²« ë²ˆì§¸ ì¼œì§„ ë¨¸ì‹ ì—ì„œë§Œ ì•„ì´í”¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒì•„ê°€ê²Œ ë˜ëŠ” ê²ƒ. 
ì˜ë¬¸ì 2: virtual box host-onlybox networkì˜ ip
	â€”> ì•„ë˜ 3ë²ˆì—ì„œ í•´ê²°

1) NAT ë„¤íŠ¸ì›Œí¬ë¡œ í˜¸ìŠ¤íŠ¸ IPë¡œ í¬íŠ¸í¬ì›Œë”© í•˜ë˜ê±¸   
 ex) 192.168.3.52:80 ----> 10.0.2.4:80
ëœì¹´ë“œ 2ê°œë¥¼ ì‚¬ìš©í•´ì„œ ë¸Œë¦¿ì§€ ì„¤ì •ì„ í•˜ê²Œ ë˜ë©´ ì›ë˜ NAT ë„¤íŠ¸ì›Œí¬ì—ì„œ 
ì„¤ì •í–ˆë˜ í¬íŠ¸í¬ì›Œë”©ì´ ë¨¹íˆì§€ ì•ŠëŠ”ë‹¤. NAT ë„¤íŠ¸ì›Œí¬ê°€ ì‚¬ìš©ë˜ì§€ ì•Šê²Œ ëœë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

2) DHCP ì„œë²„ê°€ ì—†ìœ¼ë©´(ìë™ìœ¼ë¡œ IPë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” í™˜ê²½ì—ì„œ) ë¸Œë¦¿ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. 

3) NAT ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ëœ ê°€ìƒ ë¨¸ì‹ ì€ ì™¸ë¶€ ì»´í“¨í„°ì—ì„œ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ(ì´ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²ƒì´ í¬íŠ¸í¬ì›Œë”©)
, ì¸í„°ë„·ì€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ë‹¨ë°©í–¥ í†µì‹ ì´ë¼ ì¹­í•˜ëŠ”ë°, Host-Only ë°©ì‹ì€ ë‹¨ë°©í–¥ í†µì‹ ë„ ë¶ˆê°€ëŠ¥í•œ êµ¬ì„±ì´ë‹¤.
ê·¸ë˜ì„œ Host-Only ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•˜ë©´ Host í˜¹ì€ Guestë¼ë¦¬ë§Œ í†µì‹ í•  ìˆ˜ ìˆë‹¤.
(ê·¸ë˜ì„œ Host-Only ì–´ëŒ‘í„°ëŠ” ê²Œì´íŠ¸ì›¨ì´ê°€ ì—†ëŠ”ê±´ê°€?)
Host-Onlyë¡œ êµ¬ì„±ëœ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ë‚´ì˜ ê°€ìƒë¨¸ì‹ 4ì— NAT ì—°ê²°ì„ ì„ ì¶”ê°€í•œ í›„ ê°€ìƒë¨¸ì‹ 4ë¥¼ ê²Œì´íŠ¸ì›¨ì´ë¡œ ì‚¬ìš©í•˜ë©´,
ê°€ìƒë¨¸ì‹  1,2,3ì—ì„œë„ ì™¸ë¶€ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ê²Œë” ì…‹íŒ…í•  ìˆ˜ ìˆë‹¤. 

4) ë˜ ë‹¤ë¥¸ ì°¸ê³ ë¸”ë¡œê·¸: https://wookoa.tistory.com/107

## âœ” VirtualBoxë¡œ ë„¤íŠ¸ì›Œí¬ ê°œë… ê³µë¶€í•˜ê¸°(2)

* ì™¸ë¶€ì—ì„œ ì§ì ‘ db ì„œë²„ì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í•´ì„œëŠ” ì•ˆëœë‹¤. 
webì„œë²„(ì˜¤í”ˆë¨)ì—ì„œ ë‹¤ì‹œ í•œ ë²ˆ db ì„œë²„ë¡œ ì ‘ì†í•˜ëŠ” ë°©ì‹ ë“±ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

* `sudo apt-get -y update`  
 íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë°›ì„ ê³³ì„ ëª…ì‹œí•´ì£¼ëŠ” ëª…ë ¹ì–´. installí•˜ê¸° ì „ì— í•­ìƒ ì‹¤í–‰

* MariaDB ì„¤ì¹˜ì‹œ  
 `Disallow root login remotely` : ë¡œì»¬ì—ì„œë§Œ ë£¨íŠ¸ê³„ì •ì„ ì‚¬ìš©í•˜ê²Œ í•œë‹¤. ë³´ì•ˆì„ ìœ„í•´ Yes
ê·¸ëŸ¬ë©´ mysql -h 10.0.2.5 -u root -p ëª…ë ¹ì–´ë¡œ ì›ê²©ì—ì„œ mariadb ì„œë²„ì˜ mysqlì— rootë¡œ ì ‘ê·¼ ë¶ˆê°€  

MariaDB ì„¤ì¹˜
```sh
$ sudo apt-get -y update
$ sudo apt-get -y install mariadb-server
$ sudo mysql_secure_installation
$ sudo vi /etc/mysql/mariadb.conf.d/50-server.cnf
# bind-address            = 127.0.0.1

$ sudo systemctl restart mysql
$ sudo mysql -u root -p
CREATE USER 'wpuser'@'%' IDENTIFIED BY 'wppass';
CREATE DATABASE IF NOT EXISTS wordpress;
GRANT ALL PRIVILEGES ON wordpress.* TO 'wpuser'@'%';
quit

ì›Œë“œí”„ë ˆìŠ¤ ì„¤ì¹˜
$ wget https://ko.wordpress.org/wordpress-4.8.2-ko_KR.zip
$ yum install -y httpd php php-mysql php-gd php-mbstring wget unzip
$ cd /var/www/html
$ unzip /root/wordpress-4.8.2-ko_KR.zip
$ chown -R apache:apache wordpress
$ setenforce 0 # ì›¹ì„œë²„ê°€ êº¼ì¡Œë‹¤ê°€ ë‹¤ì‹œ ì¼œì§€ë©´ SELinuxê°€ ì‚´ì•„ë‚˜ê¸° ë•Œë¬¸ì— ì˜êµ¬ì ìœ¼ë¡œ disable ì‹œì¼œì£¼ëŠ” ë°©ë²•ì„ ì„ íƒí•´ì•¼í•œë‹¤. ì´ëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¡œ í•´ê²°í•œë‹¤.
$ vi /etc/selinux/config  # SELINUX=disabledë¡œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. ë˜ëŠ” vi /etc/sysconfig/selinux 
$ systemctl restart httpd
# ì›¹ë¸Œë¼ìš°ì € http://ë³¸ì¸ ip/wordpress
```

## âœ” ë„ì»¤ ê°œë…ì •ë¦¬

ë¬¼ë¦¬ì„œë²„ > ê°€ìƒì„œë²„ > ì¸ìŠ¤í„´ìŠ¤(í´ë¼ìš°ë“œ) > ì»¨í…Œì´ë„ˆ > ì„œë²„ë¦¬ìŠ¤

CI/CD
Integration
Deployment(+Delivery)

BaseImage: ì»¤ë„x, OSx, ë‹¨ìˆœí•œ ëª…ë ¹ì–´, ë¼ì´ë¸ŒëŸ¬ë¦¬, ì˜ì¡´ì„± íŒŒì¼ë“¤ë§Œ ìˆìŒ. í˜¸ìŠ¤íŠ¸ OSì˜ ì»¤ë„ê¸°ëŠ¥ì„ ê³µìœ í•´ì„œ ì´ìš© 
ex) ìš°ë¶„íˆ¬ì—ì„œ í•„ìš”í•œ ëª…ë ¹ì–´(ex.apt-get), CentOS(ex.yum) ì •ë„ë§Œ ëª¨ì•„ë†“ìŒ.

Docker ì´ë¯¸ì§€: 1) Docker ì»¨í…Œì´ë„ˆë¥¼ êµ¬ì„±í•˜ëŠ” íŒŒì¼ ì‹œìŠ¤í…œ + ì‹¤í–‰í•  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • => ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ëŠ” íƒ¬í”Œë¦¿
	     2) íŒ¨í‚¤ì§• ëœ ì†ŒìŠ¤ì½”ë“œ 	
Docker ì»¨í…Œì´ë„ˆ: Dokcer ì´ë¯¸ì§€ê°€ ì‹¤í–‰ëœ ìƒíƒœ 

Docker ë¼ì´í”„ì‚¬ì´í´
create + start => run

Docker ì—”ì§„ì„ ì„¤ì¹˜í•˜ë©´ ë„ì»¤ í˜¸ìŠ¤íŠ¸ê°€ ë˜ëŠ” ê²ƒì´ë‹¤. 

### docker ì„¤ì¹˜
(sedì˜µì…˜ ì •ë¦¬: https://blog.naver.com/int_s/220483567708)

`curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh 
yum -y install bash-completion`
==> tab ìë™ì™„ì„± í™œì„±í™”
`curl https://download.docker.com/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo`  ==> ë„ì»¤ ë¦¬í¬ì§€í† ë¦¬ê°€ yum ë¦¬í¬ì§€í† ë¦¬ì— ë“±ë¡ì´ ëœë‹¤.  
`sed -i -e "s/enabled=1/enabled=0/g" /etc/yum.repos.d/docker-ce.repo` ==> ìœ„ íŒŒì¼ì˜ enabled=1ê³¼ ì¼ì¹˜í•˜ëŠ” ë¬¸ìë¥¼ enabled=0ë¡œ ì¹˜í™˜  
`yum --enablerepo=docker-ce-stable -y install docker-ce-19.03.15-3.el7`  
`systemctl enable --now docker`

## âœ” ëª…ë ¹ì–´ë“¤
`docker search nginx`: Docker Hubì—ì„œ ì´ë¯¸ì§€ ê²€ìƒ‰  
`docker image ls`: í˜„ì¬ ë„ì»¤ í˜¸ìŠ¤íŠ¸ ì•ˆì— ì´ë¯¸ì§€ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰  
* ë„ì»¤ì—ì„œì˜ ìƒëµ í‘œí˜„  
docker images = docker image ls   
docker (image, container ë“± ìƒëµê°€ëŠ¥) inspect test_commit:v1.0  
docker (image, container ë“± ìƒëµê°€ëŠ¥) start webserver   

`docker image pull nginx`: Docker Hubì—ì„œ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°   
`docker image inspect --format="{{.Os}}" nginx`: í•˜ë‚˜ ì´ìƒì˜ ì´ë¯¸ì§€ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ í‘œì‹œ, format ì˜µì…˜ì€ ì›í•˜ëŠ” ì •ë³´ë§Œ ì¶œë ¥  
`docker container create -p 80:80 --name webserver nginx`: í˜¸ìŠ¤íŠ¸í¬íŠ¸:ì»¨í…Œì´ë„ˆí¬íŠ¸ë¡œ í¬íŠ¸í¬ì›Œë”©, --nameì€ ì»¨í…Œì´ë„ˆ ì´ë¦„, ë§ˆì§€ë§‰ì€ ì‚¬ìš©í•  ì´ë¯¸ì§€  
`docker container start webserver`: ì»¨í…Œì´ë„ˆ ì‹œì‘  
`docker container stop webserver`: ì»¨í…Œì´ë„ˆ ì •ì§€  
`docker container rm -f webserver`: ì»¨í…Œì´ë„ˆ ì‚­ì œ, ì›ë˜ëŠ” stopí•˜ê³  rmí•´ì•¼ë˜ëŠ”ë° ìš´ì˜ì¤‘ì— ìˆëŠ” ì»¨í…Œì´ë„ˆë„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.  
* ë„ì»¤ ì»¨í…Œì´ë„ˆ í¬íŠ¸ë²ˆí˜¸, ì´ë¦„(â€”name)ì€ unique í•´ì•¼í•œë‹¤.   

## `docker container run [ì˜µì…˜] ì´ë¯¸ì§€[:íƒœê·¸][ì¸ìˆ˜]`

ì˜µì…˜
```
--publish, -p : í¬íŠ¸í¬ì›Œë”© 
--detach, -d : ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•œë‹¤
--interactive, -i: í‘œì¤€ ì…ë ¥ì„ ì—°ë‹¤  
--tty, -t: í„°ë¯¸ë„ì„ ì‚¬ìš©í•œë‹¤  
```

ì‚¬ìš©ì˜ˆì‹œ  
1. `docker container run --name test_cal centos /bin/cal`   
ì‚¬ìš©ëœ /bin/cal ì¸ìˆ˜ëŠ” ìƒì„±ëœ centos ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰ í›„ ë„ì»¤ í˜¸ìŠ¤íŠ¸ì—ê²Œ ê²°ê³¼ë¥¼ ë‚´ë³´ë‚´ì¤€ë‹¤.
2. `docker container run -it --name test_bash centos /bin/bash`  
-itì™€ /bin/bashë¥¼ í•¨ê»˜ ì¨ì•¼ ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤. -ië§Œ ì…ë ¥í•˜ë©´ í„°ë¯¸ë„ í™˜ê²½ì´ ì•„ë‹Œ í™˜ê²½ì—ì„œ /bin/bashê°€ ì‹¤í–‰ë˜ê³ ,
-të§Œ ì…ë ¥í•˜ë©´ ì…ë ¥ì´ ë˜ì§€ ì•Šì•„ ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ì–´ì§„ë‹¤. /bin/bashëŠ” ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ì‰˜ë¡œ ì ‘ì†ì€ ëœë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ ì»¨í…Œì´ë„ˆë¥¼ ë¹ ì ¸ë‚˜ì˜¤ë©´
ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œëœë‹¤. ì¦‰ ì¼ì‹œì ìœ¼ë¡œ ì´ìš©í•œ ê²ƒì´ë‹¤.   
`docker container run -it --name mysql_client mysql mysql -h 192.168.3.116 -u wpuser -p`
3. ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰  
`docker container run -d --name test_ping centos /bin/ping localhost` : d ì˜µì…˜
4. ì»¨í…Œì´ë„ˆ ì ‘ì† í¬íŠ¸ ì„¤ì •  
`docker container run -d -p 8080:80 --name test_port nginx`
`docker container run -d -P nginx ` => í¬íŠ¸ë²ˆí˜¸ì™€ ì»¨í…Œì´ë„ˆ ì´ë¦„ì„ ëœë¤í•˜ê²Œ ë¶€ì—¬í•œë‹¤. 
5. ì»¨í…Œì´ë„ˆ ìƒíƒœ  
`docker container stats test_port ` 

dockerì—”ì§„ì´ ìë™ìœ¼ë¡œ cpuì™€ memoryë¥¼ í• ë‹¹í•´ì£¼ëŠ”ë°, ì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…‹íŒ…í•˜ëŠ” ëª…ë ¹:  
`docker container run -d -p 8181:80 --cpus 1 --memory=256m --name test_resource nginx`   
-> memory=ê°’ ë˜ëŠ” memory ê°’ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥

## âœ”ì»¨í…Œì´ë„ˆ ë””ë ‰í„°ë¦¬ ê³µìœ   

`docker volume create test_vol` : ë³¼ë¥¨ ìƒì„±     
ê·¸ëŸ¼ ë§Œë“¤ì–´ì§„ ë³¼ë¥¨ test_volì˜ ê²½ë¡œê°€ ì–´ë””ìˆì„ê¹Œ?      
`docker volume inspect test_vol`     
ê²°ê³¼: (ìƒëµ) "Mountpoint": "/var/lib/docker/volumes/test_vol/_data" (ìƒëµ)  
íŠ¹ì • ê²½ë¡œë¡œ ë³¼ë¥¨ì„ ë§Œë“œëŠ” ë°©ë²•ì€ ì•„ì§ ì—†ë‹¤ê³  í•œë‹¤.   
`docker run -d -p 9898:80 --cpu-shares 256 --memory 128m --volume test_vol:/usr/share/nginx/html --name volume-container9 nginx`    
```sh
# ê¸°ì¡´ìƒí™©: ì»¨í…Œì´ë„ˆê°€ ì‚­ì œë˜ë©´ ì»¨í…Œì´ë„ˆ ì•ˆì˜ ë°ì´í„°ë“¤ë„ ì‚¬ë¼ì ¸ë²„ë¦°ë‹¤ 
docker container exec -it test_resource /bin/bash
cd /usr/share/nginx/html(nginx)
echo "<h1>soon kwon</h1>" > index.html  
docker container rm -f test_resource

# Persistent volume(=ìŠ¤í† ë¦¬ì§€)ì¸ ìƒí™©  
docker container run -d -p 8282:80 --cpus 1 --memory 256m -v /tmp:/usr/share/nginx/html --name volume-container nginx  
# /tmp(ë„ì»¤ í˜¸ìŠ¤íŠ¸):/usr/share/nginx/html(ì»¨í…Œì´ë„ˆ í´ë”) --> ë§ˆìš´íŠ¸ ê°œë…  
``` 

ì»¨í…Œì´ë„ˆ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ    
`docker container ls -a -f name=test`      
`docker ps -a -q -f name=test`: ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œì„¸ìŠ¤ì™€ ê°™ì€ ì˜ë¯¸. fë¡œ ì´ë¦„ì´ testì¸ ì»¨í…Œì´ë„ˆë¥¼ ê²€ìƒ‰. -që¡œ IDë§Œ ë³´ì´ê²Œ.        

ë™ì‘ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì—°ê²°    
attach: ë‚´ê°€ ìš´ì˜ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì¤‘ì—ì„œ /bin/bashê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì»¨í…Œì´ë„ˆì—ë§Œ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.     
`docker container attach ì»¨í…Œì´ë„ˆì´ë¦„`       
í•´ë‹¹ ì‰˜ì—ì„œ ë‚˜ì˜¤ê¸°ìœ„í•´ exitë¥¼ ì…ë ¥í•˜ë©´ ì»¨í…Œì´ë„ˆê°€ ì£½ì–´ë²„ë¦°ë‹¤.  
ctrl+pì™€ ctrl+që¥¼ ì…ë ¥í•˜ë©´ read escape sequenceë¼ëŠ” ë©”ì‹œì§€ì™€ í•¨ê»˜ ì‰˜ì„ ë¹ ì ¸ë‚˜ì˜¤ë©° 
ì»¨í…Œì´ë„ˆê°€ ì‚´ì•„ìˆëŠ” ìƒíƒœì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## âœ” ë™ì‘ì¤‘ì¸ ì»¨í…Œì´ë„ˆì—ì„œ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰  
ê¸°ë³¸êµ¬ë¬¸: `docker container exec [ì˜µì…˜] <ì»¨í…Œì´ë„ˆ> <ì‹¤í–‰ëª…ë ¹> [ì¸ìˆ˜]`  
ì‚¬ìš©ì˜ˆì‹œ: `docker container exec (-it) test_bash /bin/echo "Hello World"`  
`docker container exec (-it) test_bash /bin/yum install -y mysql`  
ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ í„°ë¯¸ë„ì„ ì‚¬ìš©í•  ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— -it ì˜µì…˜ì€ ìƒëµí•´ë„ ëœë‹¤. ë°˜ë©´ mysqlê³¼ ê°™ì€ ëª…ë ¹ì–´ëŠ” í•„ìš”í•˜ë‹¤.
`docker container exec -it test_bash mysql -h 192.168.3.116 -u wpuser -p`  
ì¸ìˆ˜ì˜ '/bin/bash'ì—ì„œ '/bin/'ì„ ìƒëµí•´ë„ ëœë‹¤.  
`docker container exec -it test_bash bash`  


ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë˜ë©´ í¬íŠ¸ë„˜ë²„ë¥¼ ìˆ˜ì •/ë³€ê²½ ë¶ˆê°€í•˜ë‹¤.   
ì»¨í…Œì´ë„ˆë¥¼ commití•˜ì—¬ imageë¥¼ ë§Œë“¤ê³  ì´ ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ë‹¤ì‹œ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì–´ì„œ í¬íŠ¸ë„˜ë²„ë¥¼ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

ì»¨í…Œì´ë„ˆ ì•ˆì˜ íŒŒì¼ì„ ë³µì‚¬  
`docker container cp  webserver:/usr/share/nginx/html/index.html ./index.html`  

íŒŒì¼ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ë³µì‚¬ëœ ë‚´ìš© ì „ë‹¬   
`docker container cp ./index.html webserver:/usr/share/nginx/html/index.html`   
(!ì°¸ê³ : ë„ì»¤ í™˜ê²½ì´ ì•„ë‹Œ ì„œë²„ë¼ë¦¬ íŒŒì¼ í†µì‹ ì€ scp aws.tar root@192.168.3.110:/root ì´ëŸ°ì‹ìœ¼ë¡œ í•œë‹¤.)    
`docker container cp ./html webserver:/usr/share/nginx`   
(!ì°¸ê³ : tar -xvf aws.tar -C html/ëŠ” htmlí´ë”ì— aws.tar ì••ì¶•ì´ í’€ë¦° íŒŒì¼ë“¤ì„ ë„£ê² ë‹¤.   
 x: extract, v: verbosely...ì••ì¶• í’€ë¦° íŒŒì¼ë“¤ì„ ë³´ì—¬ì£¼ëŠ” ì˜µì…˜, f: archive file)  

ì»¨í…Œì´ë„ˆì™€ ì›ë³¸ ì´ë¯¸ì§€ì˜ ì°¨ì´ì  í™•ì¸   
`docker container diff ì»¨í…Œì´ë„ˆì´ë¦„` 

## âœ” ì»¨í…Œì´ë„ˆë¥¼ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ê¸°  
`docker container commit [ì˜µì…˜] ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì´ë¦„[:íƒœê·¸]`  
`docker container commit -a "soon<soon@example.com>" -m "NICE TO MEET YOU" test_port test_commit:v1.0`  

ì´ë¯¸ì§€ ì •ë³´ ë³´ê¸°  
`docker image inspect test_commit:v1.0`  
`docker image inspect test_commit:v1.0 | grep Author`  

(!ì°¸ê³ : sudoì—†ì´ dockerë¥¼ ì´ìš©í•˜ëŠ” ëª…ë ¹ì–´)    
sudo usermod -a -G docker soon í›„ ì¬ì ‘ì†: Gë¡œ ì–¸ê¸‰ëœ ê·¸ë£¹ì— soonìœ ì €ë¥¼ ê¸°ì¡´ì— ì†í•œ ê·¸ë£¹ì—ì„œ ì‚­ì œí•˜ì§€ ì•Šê³  G ê·¸ë£¹ì— ì‚¬ìš©ìë¥¼ ì¶”ê°€í•œë‹¤.    

ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥  
ë³´í†µì€ ë„ì»¤ í—ˆë¸Œì— ì˜¬ë¦¬ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ì§€ë§Œ ì¸í„°ë„· í™˜ê²½ì´ ì•ˆë˜ê±°ë‚˜ í•˜ëŠ” ìƒí™©ì—ì„œ ì“°ì„  
`docker image save [ì˜µì…˜] <ì €ì¥ íŒŒì¼ëª…> [ì´ë¯¸ì§€ì´ë¦„] `  
`docker image save -o test_commit.tar test_commit:v1.0: oëŠ” write to a file, instead of STDOUT`  

tar ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
`scp test_commit.tar soon@192.168.3.116:/home/soon`: í…ŒìŠ¤í„° í™˜ê²½ì— tar íŒŒì¼ ë³´ë‚´ê¸°       

í…ŒìŠ¤í„° í™˜ê²½ì—ì„œ ì´ë¯¸ì§€ tar íŒŒì¼ë¡œ ì´ë¯¸ì§€ ìƒì„±   
`docker image load -i test_commit.tar` : iì˜µì…˜ì€ Read from tar archive file, instead of STDIN  

## âœ” Docker ë„¤íŠ¸ì›Œí¬ 
eth0 --> enp0s3: ê°€ìƒì˜ ëœì¹´ë“œ  
docker0: DHCP, Port Forwardì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ê°€ìƒì˜ ë¸Œë¦¿ì§€. ì»¨í…Œì´ë„ˆëŠ” docker0ì˜ 172.17.0.1ë¥¼ ê²Œì´íŠ¸ì›¨ì´ë¡œ í•œë‹¤.  
veth: ê°€ìƒì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤  

ë„ì»¤ í˜¸ìŠ¤íŠ¸ì˜ veth  
29: veth69c9dd3@if28  
	  
â†• (28-28 ë§í¬ë¨)  
	  
centOS ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ip aë¡œ ì–»ì€ ì •ë³´   
28: eth0@if29  
  
### Docker ë„¤íŠ¸ì›Œí¬ ìƒì„± ë° ì‚­ì œ  
`docker network create [ì˜µì…˜] ë„¤íŠ¸ì›Œí¬ì´ë¦„`  

ì˜µì…˜  
-d: ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¬ì§€ ë˜ëŠ” ì˜¤ë²„ë ˆì´   
--ip-range: ì»¨í…Œì´ë„ˆì— í• ë‹¹í•˜ëŠ” IPì£¼ì†Œì˜ ë²”ìœ„ ì§€ì •  
--subnet: ì„œë¸Œë„·ì„ CIDR í˜•ì‹ìœ¼ë¡œ ì§€ì •  

ì‚¬ìš©ì˜ˆì‹œ  
`docker network create -d bridge --subnet 192.168.123.0/24 --ip-range 192.168.123.0/24 test_bridge`  
`docker network create -d bridge my_bridge` : ë„ì»¤ ì—”ì§„ì´ ìë™ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ë§Œë“¤ì–´ì¤€ë‹¤.  
`docker network inspect my_brige`: ìƒì„¸í•œ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.  
Docker ë„¤íŠ¸ì›Œí¬ ì—°ê²°  
`docker network connect test_bridge ì»¨í…Œì´ë„ˆì´ë¦„`  
Docker ë„¤íŠ¸ì›Œí¬ ì—°ê²°ëŠê¸°    
`docker network disconnect test_bridge ì»¨í…Œì´ë„ˆì´ë¦„ `

âœ… ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ ì£¼ëŠ” ì´ìœ  --> ì»¨í…Œì´ë„ˆ ì´ë¦„ê°„ì— í†µì‹ ì„ í•  ìˆ˜ ìˆë‹¤.
docker0(172.17.0.1) ë¸Œë¦¬ì§€ëŠ” ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ í•  ìˆ˜ ì—†ë‹¤!!  
  
ê·¸ëŸ¼ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œë¶€í„° docker0 ë„¤íŠ¸ì›Œí¬ë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  ë‚´ê°€ ë§Œë“  ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ ë•Œ  
`docker container run -d --name test1 --network test_bridge -p 8080:80 nginx`  
`docker container run -d --name test2 --network test_bridge -p 8080:80 nginx`  
exec -it ëª…ë ¹ìœ¼ë¡œ ì„œë¡œ ping test1, pint test2 ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ í†µì‹  ê°€ëŠ¥í•´ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  

### Docker ì˜¤ë¸Œì íŠ¸ ì‚­ì œ  
`docker container prune`      
`docker image prune -a`: ì‚¬ìš©í•˜ê³  ìˆì§€ ì•Šì€ ì´ë¯¸ì§€ ëª¨ë‘ ì‚­ì œ            
`docker rm -f test_b test_a`: ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ ì§€ìš°ê¸°          
`docker rm -f b5f3 d020`: ì»¨í…Œì´ë„ˆ IDë¡œ ì§€ìš°ê¸°     
`docker rm -f $(docker ps -a -q)`: run ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•´ì„œ ì „ì²´ ì»¨í…Œì´ë„ˆ ì‚­ì œ     
`docker rmi -f $(docker images -q)`: run ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•´ì„œ ì „ì²´ ì»¨í…Œì´ë„ˆ ì‚­ì œ

## âœ” ë„ì»¤íŒŒì¼ ê³µë¶€ ì „ ì‹¤ìŠµ 

### ì´ë¯¸ì§€ë¥¼ commití•˜ëŠ” ê²ƒê³¼ dockerfileë¡œ imageë¥¼ buildí•˜ëŠ” ê²ƒì˜ ì°¨ì´ë¥¼ ì•Œì•„ë³´ê¸° ìœ„í•´ ì§„í–‰
### ìˆ˜ë™ìœ¼ë¡œ ë„ì»¤ dbserver ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```sh

# ì²˜ìŒ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ ë•Œ ì„¤ì •í•˜ëŠ” ê°’ë“¤ì€ ë³€ê²½ì´ ì œí•œì ì´ê¸° ë•Œë¬¸ì— ì²˜ìŒ ë§Œë“¤ ë•Œ ì˜ ë§Œë“¤ì. 
# volumn ì„¤ì •ì—ì„œ /db í´ë”ê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.
# volumn ì„¤ì •ì„ í•˜ê³  commitì„ í•˜ë©´ í…ŒìŠ¤í„° í™˜ê²½ì—ì„œ load í•  ë•Œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
# ì´ì— ëŒ€í•œ ì„¤ëª…ì€ ì•„ë˜ í…ŒìŠ¤í„° í™˜ê²½ì—ì„œ ì„¤ëª….  
# docker run -it -d -p 3306:3306 --name dbserver --network my_bridge -v /db:/var/lib/mysql [--workdir /var/lib/mysql --restart always] ubuntu:16.04
docker run -it -d -p 3306:3306 --name dbserver --network my_bridge [--workdir /var/lib/mysql --restart always] ubuntu:16.04
docker exec -it dbserver bash # ì•ì—ì„œ ì„¤ì •í•œ workdir ë•Œë¬¸ì— ë“¤ì–´ê°€ìë§ˆì ê²½ë¡œê°€ /var/lib/mysqlì´ ëœë‹¤.
# ì»¨í…Œì´ë„ˆ ì•ˆ
sed -i 's/archive.ubuntu.com/ftp.daumkakao.com/g' /etc/apt/sources.list # ê°€ê¹Œìš´ ì €ì¥ì†Œë¡œ ì„¤ì •
apt-get update && apt-get install mariadb-server -y # &&ëŠ” ì•ì˜ ëª…ë ¹ì–´ê°€ ì„±ê³µí•œ ê²½ìš° ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ cf) &ëŠ” ëª…ë ¹ì–´ë¥¼ ë°±ê·¸ë¼ìš´ë“œë¡œ ë™ì‘ì‹œí‚¬ ë•Œ ì‚¬ìš©
sed -i 's/bind-address/#bind-address/g' /etc/mysql/mariadb.conf.d/50-server.cnf
/etc/init.d/mysql start
mysql_secure_installation
mysql -u root -p
# ERROR 2003 (HY000): Can't connect to MySQL server on 'dbserver' (111) ë°œìƒì‹œ
# service mysql restart
CREATE USER 'wpuser'@'%' IDENTIFIED BY 'wppass';
CREATE DATABASE IF NOT EXISTS wordpress;
GRANT ALL PRIVILEGES ON wordpress.* TO 'wpuser'@'%';
quit
``` 

### ìˆ˜ë™ìœ¼ë¡œ ë„ì»¤ webserver ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```sh
docker run -itd -p 80:80 --name webserver --network my_network -w /var/www/html centos:7
docker exec -it webserver bash
# ì»¨í…Œì´ë„ˆ ì•ˆ
yum install -y httpd php php-mysql php-gd php-mbstring wget unzip mysql
wget https://ko.wordpress.org/wordpress-4.8.2-ko_KR.zip
cd /var/www/html
unzip /wordpress-4.8.2-ko_KR.zip
cp -r wordpress/* . # ipì£¼ì†Œ/wordpressê°€ ì•„ë‹Œ ë£¨íŠ¸ê²½ë¡œë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì„¤ì •
chown -R apache:apache /var/www/html
httpd & # &ëŠ” ë°±ê·¸ë¼ìš´ë“œë¡œ ë™ì‘í•˜ë¼ëŠ” ì˜ë¯¸

# í…ŒìŠ¤í„°ë¡œ ì´ë¯¸ì§€ ë³´ë‚´ê¸° ìœ„í•œ ì‘ì—…
docker commit webserver webserver:v1.0
docker commit dbserver dbserver:v1.0

docker save -o webserver.tar webserver:v1.0
docker save -o dbserver.tar dbserver:v1.0

scp webserver.tar dbserver.tar soon@192.168.3.116:/home/soon
```
### ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ë¥¼ í…ŒìŠ¤í„° í™˜ê²½ì—ì„œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```sh
# ë°›ì€ taríŒŒì¼ì„ ì´ë¯¸ì§€ë¡œ ë¡œë“œ
docker load -i webserver.tar
docker load -i dbserver.tar

docker network create new_network
docker volume create db
docker volume create web

docker run -it -d -p 3306:3306 --name dbserver \
--network new_network -v db:/var/lib/mysql -w /var/lib/mysql \
--cpu-shares 512 --memory 256m dbserver:v1.0

docker run -itd -p 80:80 --name webserver \
--network new_network -v web:/var/www/html \
-w /var/www/html --cpu-shares 512 --memory 256m webserver:v1.0
 
# ë§¨ ìœ„ ì£¼ì„ì²˜ë¦¬ëœ runêµ¬ë¬¸ìœ¼ë¡œ ìƒì„±ëœ ì»¨í…Œì´ë„ˆë¡œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì—ˆë‹¤ë©´ ì •ìƒ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.
# ê·¸ ì´ìœ ëŠ” develop í™˜ê²½ì—ì„œ imageë¥¼ commit í•  ë•Œ ì´ë¯¸ì§€ë¡œ ìƒì„±í•  ì»¨í…Œì´ë„ˆê°€ ë³¼ë¥¨ì„ ì‚¬ìš©í–ˆëŠ”ë°, 
# ë„ì»¤ í˜¸ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ëŠ” ë³¼ë¥¨ì˜ ë°ì´í„°ê¹Œì§€ ì´ë¯¸ì§€ë¥¼ commití•  ë•Œ ë°›ì•„ì˜¤ì§€ ëª»í•œë‹¤. 
# ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ë•Œ ê¼­ í•„ìš”í•œ íŒŒì¼ë“¤ì€ ë³¼ë¥¨ì„ ì‚¬ìš©í•´ì„œëŠ” ì•ˆë˜ê³ 
# ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì„œ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ ë•ŒëŠ” ë³¼ë¥¨ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

docker exec -it dbserver bash
# ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì„œë¹„ìŠ¤ ì‹œì‘
/etc/init.d/mysql start

docker exec -it webserver bash
# ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì„œë¹„ìŠ¤ ì‹œì‘
httpd &

docker exec -it webserver mysql -h dbserver -u wpuser -p
```
### ìë™ìœ¼ë¡œ ë„ì»¤ dbserver ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```sh
# -eëŠ” environment, í™˜ê²½ë³€ìˆ˜ ì˜µì…˜
docker run -d -p 3306:3306 --name dbserver \
-e MYSQL_DATABASE=wordpress \
-e MYSQL_USER=wpuser \
-e MYSQL_PASSWORD=wppass \
-e MYSQL_ROOT_PASSWORD=test1234 \
--network my_network -v db:/var/lib/mysql mariadb

```

### ìë™ìœ¼ë¡œ ë„ì»¤ webserver ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```sh
# -eëŠ” environment, í™˜ê²½ë³€ìˆ˜ ì˜µì…˜
docker run -d -p 80:80 --name webserver \
-e WORDPRESS_DB_NAME=wordpress \
-e WORDPRESS_DB_USER=wpuser \
-e WORDPRESS_DB_PASSWORD=wppass \
-e WORDPRESS_DB_HOST=dbserver \
--network my_network -v web:/var/www/html wordpress:4.8.2

```

## âœ” ë„ì»¤íŒŒì¼ 
IaC(Infra as Code) => ìë™í™”
Docker íŒŒì¼ì€ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ëŠ” ì—¬ëŸ¬ êµ¬ì„± ì •ë³´ë¥¼ í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ì •ë¦¬í•˜ê³  ì¼ê´„ ì‹¤í–‰í•˜ì—¬ docker build ëª…ë ¹ì„ í†µí•´ 

|COMMAND|ì„¤ëª…|COMMAND|ì„¤ëª…|
|---|---|---|---|
|FROM|ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì§€ì •|ADD|(ì••ì¶•)íŒŒì¼ ì¶”ê°€|
|MAINTAINER|ì‘ì„±ì ì§€ì •|COPY|íŒŒì¼ ë³µì‚¬|
|RUN|ëª…ë ¹ì–´ ì‹¤í–‰|VOLUME|ë³¼ë¥¨ ë§ˆìš´íŠ¸|
|CMD|ë°ëª¬ ì‹¤í–‰|ENTRYPOINT|ë°ëª¬ ì‹¤í–‰|
|LABEL|ë¼ë²¨ ì„¤ì •|USER|ì‚¬ìš©ì ì„¤ì •|
|EXPOSE|í¬íŠ¸ ë‚´ë³´ë‚´ê¸°|WORKDIR|ì‘ì—… ë””ë ‰í† ë¦¬ ì§€ì •|
|ENV|í™˜ê²½ ë³€ìˆ˜ ì„¤ì •|ONBUILD|ë¹Œë“œ í›„ ì‹¤í–‰ ëª…ë ¹|
  
* RUN vs CMD vs ENTRYPOINT: 
    - RUN. ìƒˆë¡œìš´ ë ˆì´ì–´ì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³ , ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤. ë³´í†µ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë“±ì— ì‚¬ìš©ëœë‹¤. e.g. apt-get
    - CMD. default ëª…ë ¹ì´ë‚˜ íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•œë‹¤. docker run ì‹¤í–‰ ì‹œ ì‹¤í–‰í•  ì»¤ë§¨ë“œë¥¼ ì£¼ì§€ ì•Šìœ¼ë©´ ì´ default ëª…ë ¹ì´ ì‹¤í–‰ëœë‹¤. ê·¸ë¦¬ê³  ENTRYPOINTì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìˆë‹¤. CMDì˜ ì£¼ìš©ë„ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•  defaultë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤.
    - ENTRYPOINT. ì»¨í…Œì´ë„ˆê°€ ì‹œì‘í•  ë•Œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì–´.
    - ENTRYPOINTëŠ” ë°°í¬í•  dockerê°€ ì‹¤í–‰ë˜ë©´ì„œ í•­ìƒ ìˆ˜í–‰í•´ì•¼í•˜ëŠ” ëª…ë ¹ì–´ ì§€ì •. ì›¹ì„œë²„, db ë“± í”„ë¡œì„¸ìŠ¤ê°€ í•­ìƒ êµ¬ë™ë˜ëŠ” ê²½ìš°ì— ì‚¬ìš©
    - CMDëŠ” dockerë¥¼ ë°°í¬í•˜ëŠ” ì‹œì  ë° í™˜ê²½ì— ë”°ë¼ commandë¥¼ ë‹¤ì–‘í•˜ê²Œ ì§€ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°ì— ì‚¬ìš©
    - ì •ë¦¬: https://blog.naver.com/PostView.nhn?isHttpsRedirect=true&blogId=freepsw&logNo=220982529575    
* ADD vs COPY: ADDì™€ COPYëŠ” íŠ¹ì • ìœ„ì¹˜ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” Dockerfile ëª…ë ¹ì–´ì´ë‹¤. COPYëŠ” ë¡œì»¬ íŒŒì¼ ë˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆì— ë³µì‚¬í•˜ëŠ” ê¸°ëŠ¥ë§Œ ì§€ì›í•œë‹¤.
ADDë„ í•´ë‹¹ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ë§Œ, 2ê°œì˜ ë˜ë‹¤ë¥¸ ê¸°ëŠ¥ë„ ì§€ì›í•œë‹¤. ë¨¼ì €, ë¡œì»¬ íŒŒì¼ ë˜ëŠ” ë””ë ‰í† ë¦¬ ëŒ€ì‹  URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.   
ë‘ë²ˆì§¸ë¡œëŠ” ADD rootfs.tar.xz /ì²˜ëŸ¼ ì†ŒìŠ¤ì—ì„œ ëŒ€ìƒìœ¼ë¡œ ì§ì ‘ taríŒŒì¼ì„ ìë™ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.
ë”°ë¼ì„œ ë¡œì»¬ì— ìˆëŠ” ì••ì¶• íŒŒì¼ì„ Docker ì´ë¯¸ì§€ì˜ íŠ¹ì • ë””ë ‰í† ë¦¬ì— ì¶”ì¶œí•˜ë ¤ëŠ” ê²½ìš° ë˜ëŠ” ì›ê²©ì§€ì˜ íŒŒì¼ì„ Docker ì´ë¯¸ì§€ë¡œ ë³µì‚¬í•˜ë ¤ëŠ” ê²½ìš° ì— ADDë¥¼ ì‚¬ìš©í•˜ê³ , ë‹¨ìˆœíˆ ë¡œì»¬ íŒŒì¼ ë˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ Docker ì´ë¯¸ì§€ë¡œ ë³µì‚¬í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” COPYë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì ì ˆí•˜ë‹¤.

### ë„ì»¤íŒŒì¼ ì—°ìŠµ
```Dockerfile
FROM ubuntu:18.04
MAINTAINER soon<soon@soon.com>
LABEL "name"="webserver"
ENV aloha=date
ENV path=/var/www/html
RUN sed -i 's/archive.ubuntu.com/ftp.daumkakao.com/g' /etc/apt/sources.list
# ì—°ì†ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ë°”ëŒì§í•œ ëª…ë ¹ì–´ë“¤ì€ í•œ ë²ˆì˜ RUN ëª…ë ¹ì–´ì— ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
RUN apt-get update && apt-get install apache2 -y
COPY nihao $path/nihao
COPY hello.html $path
ADD aws.tar $path
WORKDIR $path
RUN echo "ohayo" > ohayo.html
# VOLUMEì˜ ì™¸ë¶€ í˜¸ìŠ¤íŠ¸ ê²½ë¡œë¥¼ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ì—†ë‹¤. 
VOLUME $path
# í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ì™€ ì—°ê²°ë  í¬íŠ¸ ê°œë°©
EXPOSE 80
# apachectl -D FOREGROUNDì™€ ê°™ì€ ëœ»
ENTRYPOINT ["apachectl"]
CMD ["-D", "FOREGROUND"]
```

### ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ 
`docker build image` ì˜µì…˜: https://docs.docker.com/engine/reference/commandline/image_build/    

```sh
# ì´ë¯¸ì§€ ë¹Œë“œ: . ìœ„ì¹˜ì—ëŠ” Dockerfileì˜ ê²½ë¡œë§Œ ì§€ì •ì´ ê°€ëŠ¥
docker image build -t test_build:v1.0 .     
docker run -d -P --name test01 test_build:v1.0
# docker run -d -p 80:80 --name test02 --restart always koentc010/test_build:v2.0
    
# í˜¸ìŠ¤íŠ¸ì˜ ë§ˆìš´íŠ¸ëœ ë³¼ë¥¨ ê²½ë¡œ í™•ì¸
docker inspect test01 | grep _data   
```

### SOURCE_IMAGEë¥¼ ì°¸ì¡°í•˜ëŠ” TARGET_IMAGE íƒœê·¸ ì‘ì„±(docker image tag) => ë³„ì¹­ 
`docker image tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]`      
ì‚¬ìš©ì˜ˆì‹œ       
`docker image tag test_build:v1.0 koentc010/test_build:v1.0`

### Docker Hub ë¡œê·¸ì¸/ì—…ë¡œë“œ
`docker login`      
`docker push koentc010/test_build:v1.0`       

## Docker Compose
* Docker ComposeëŠ” ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì •ì˜í•˜ê³  ê³µìœ í•  ìˆ˜ ìˆë„ë¡ ê°œë°œëœ ë„êµ¬ë‹¤. Composeì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” YAML íŒŒì¼ì„ ë§Œë“¤ê³ , ë‹¨ì¼ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë‘ ì‹¤í–‰í•˜ê±°ë‚˜ ëª¨ë‘ ì¢…ë£Œí•  ìˆ˜ ìˆë‹¤.

### ì‚¬ìš©ì˜ˆì‹œ

```yaml
# ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
# curl -L "https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
# chmod +x /usr/local/bin/docker-compose
# mkdir my_wordpress && cd $_
# vi docker-compose.yml

version: "3.3"    
services:
  dbserver:
    image: mysql:5.7.22
    volumes: # -v
      - db_data:/var/lib/mysql
    restart: always # --restart always
    environment: # -e, ENV
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wpuser
      MYSQL_PASSWORD: wppass
  webserver:
    depends_on:
      - dbserver
    image: wordpress:4.8.2
    volumes:
      - web_data:/var/www/html
    ports: # -p 80:80
      - "80:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: dbserver
      WORDPRESS_DB_USER: wpuser
      WORDPRESS_DB_PASSWORD: wppass
      WORDPRESS_DB_NAME: wordpress
volumes: # docker volume create db_data ì—¬ê¸°ì„œ ë³¼ë¥¨ì„ ë§Œë“ ë‹¤.
  db_data: {}
  web_data: {}

# docker-compose up -d
# docker-compose ps
# docker-compose pause
# docker-compose unpause
# docker-compose config
# docker-compose stop
# docker-compose rm
# docker-compose down -v
# docker-compose down --rmi all
``` 


### Docker ì»¨í…Œì´ë„ˆ ëª¨ë‹ˆí„°ë§
```sh
VERSION=v0.36.0 # use the latest release version from https://github.com/google/cadvisor/releases
docker run \
  --volume=/:/rootfs:ro \
  --volume=/var/run:/var/run:ro \
  --volume=/sys:/sys:ro \
  --volume=/var/lib/docker/:/var/lib/docker:ro \
  --volume=/dev/disk/:/dev/disk:ro \
  --publish=8080:8080 \
  --detach=true \
  --name=cadvisor \
  --privileged \
  --device=/dev/kmsg \
  gcr.io/cadvisor/cadvisor:$VERSION
```
### ë„ì»¤ ì»´í¬ì¦ˆì—ì„œ ì‚¬ìš©ëœ ë¦¬ì†ŒìŠ¤ë“¤ ì‚­ì œ
```sh
docker system prune
#WARNING! This will remove:
# - all stopped containers
#  - all networks not used by at least one container
#  - all dangling images
#  - all dangling build cache
docker rmi -f $(docker images -q)
docker volume rm -f db web
df -h # ë§ˆìš´íŠ¸ëœ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸

# ë„ì»¤ ì»´í¬ì¦ˆì—ì„œ ì‚¬ìš©ëœ ë¦¬ì†ŒìŠ¤ë“¤ ì‚­ì œ

docker-compose stop # ìš´ì˜ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ‘
docker-compose rm  # ìš´ì˜ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker-compose down # ë„¤íŠ¸ì›Œí¬ ì‚­ì œ
docker-compose down -v # ë³¼ë¥¨+ë„¤íŠ¸ì›Œí¬ ì‚­ì œ
docker-compose down --rmi all # ì´ë¯¸ì§€ ì‚­ì œ
```


### Docker Swarm í´ëŸ¬ìŠ¤í„° êµ¬ì„±
```sh
# ë¦¬ëˆ…ìŠ¤ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ë°”ê¾¸ê¸°
hostnamectl set-hostname manager
# ë¡œì»¬ DNS ì„¤ì •
# EOF(ê¼­ ì´ ë‹¨ì–´ê°€ ì•„ë‹ˆì–´ë„ ë¨)ë¥¼ ë§Œë‚˜ê¸° ì „ê¹Œì§€ ì…ë ¥ëœ ë¬¸ìë“¤ì„ /etc/hosts íŒŒì¼ì˜ ë§¨ ë’¤ì— ë„£ê² ë‹¤.
cat <<EOF >> /etc/hosts
192.168.3.132 manager
192.168.3.140 worker1
192.168.3.146 worker2
EOF

# MANAGER 
docker swarm init --advertise-addr 192.168.3.132

# WORKER
docker swarm join --token SWMTKN-1-1mk0wfq9skxkkkxbebxcd8di3jp6x9i18312oi4a6dyei5k34a-78asdfsb0kwgbkofb0on8esqv 192.168.3.132:2377

# ë…¸ë“œ ìƒíƒœ í™•ì¸
[root@manager ~] docker node ls
ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION
rcq3w80zhdzhjow7fixqz54l9 *   manager    Ready     Active         Leader           19.03.15
lqpued6vwzmrczesyy8hn288n     worker1    Ready     Active                          19.03.15
ijwlxieil85vpsn1m87qco9j1     worker2    Ready     Active                          19.03.15

# ì„œë¹„ìŠ¤ ìƒì„±: publishedëŠ” ì„œë¹„ìŠ¤ì˜ í¬íŠ¸(ë¡œë“œë°¸ëŸ°ì‹±), targetì€ ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸. ë„ì–´ì“°ê¸° x, nameì€ ì„œë¹„ìŠ¤ì˜ ì´ë¦„
docker service create --publish published=8080,target=80 --name my_web --replicas 3 nginx

# ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œë§Œ ì„œë¹„ìŠ¤ ì¡°íšŒ ê°€ëŠ¥
[root@manager ~] docker service ls
ID             NAME      MODE         REPLICAS   IMAGE          PORTS
t37hsyn7sizl   my_web    replicated   3/3        nginx:latest   *:8080->80/tcp

# ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆ ì ‘ì† í›„ index.html ìˆ˜ì •
# sh -cëŠ” shellì„ ì‹¤í–‰í•˜ê³  -c ì˜µì…˜ì´ ìˆìœ¼ë©´ ë¬¸ìì—´ ì—ì„œ ëª…ë ¹ì„ ì½ëŠ”ë‹¤. 
docker exec -it my_web.1.e1v586az0esxpw85a181cd456 sh -c "echo '<h1>WORKER2</h1>' > /usr/share/nginx/html/index.html"

# 8080í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ MANAGER, WORKER1, WORKER2ê°€ ë²ˆê°ˆì•„ê°€ë©´ì„œ ë³´ì´ëŠ”ë°, ì´ëŠ” ì„œë¹„ìŠ¤ê°€ ë¡œë“œë°¸ëŸ°ì‹± ì—­í• ì„ í•˜ë©´ì„œ íŠ¸ë˜í”½ì„ ë¶„ë°°í•œë‹¤. ë¼ìš´ë“œ ë¡œë¹ˆ ë°©ì‹ì´ ì•„ë‹Œ ìµœì†Œ ì—°ê²° ë°©ì‹ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œë‹¤. 

docker service create --replicas 1 --name helloworld alpine ping docker.com
docker service ls
docker service logs helloworld
docker service ps helloworld
docker service inspect --pretty helloworld

# TASK(=ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ POD)ë¥¼ 5ê°œë¡œ ë§Œë“¦
docker service scale helloworld=5
docker service ps helloworld
#ID             NAME           IMAGE           NODE      DESIRED STATE   CURRENT #STATE            ERROR     PORTS
#tleengz4gt7o   helloworld.1   alpine:latest   manager   Running         Running 8 minutes ago   
#2v3kntxxzlad   helloworld.2   alpine:latest   worker2   Running         Running 54 seconds ago  
#tttosuuqg6z5   helloworld.3   alpine:latest   worker2   Running         Running 54 seconds ago  
#8hulo26jy4sv   helloworld.4   alpine:latest   manager   Running         Running 58 seconds ago  
#wmneqsf3utca   helloworld.5   alpine:latest   worker1   Running         Running 54 seconds ago  
docker service rm helloworld

```